<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ragtag.X10.model.dao.WorkbookDao">
    <!--문제집 생성-->
    <insert id="createWorkbook" parameterType="Workbook">
        INSERT INTO Workbook (subjectId, workbookTitle, workbookDetail, workbookDeadline, workbookQuota)
        VALUES (#{subjectId}, #{workbookTitle}, #{workbookDetail}, #{workbookDeadline}, #{workbookQuota});
    </insert>

    <!--문제집 상세정보 조회-->
    <select id="readWorkbookById" resultType="Workbook" parameterType="int">
        SELECT *
        FROM Workbook
        WHERE workbookId = #{workbookId}
    </select>

    <!--과목 내 문제집 조회-->
    <select id="readAllWorkbooksBySubjectId" resultType="Workbook" parameterType="int">
        SELECT *
        FROM Workbook
        WHERE subjectId = #{subjectId}
    </select>

    <!--최근에 만들어진 문제집 : 유저가 속한 모든 그룹의 모든 과목의 최신 문제집 가져오기-->
    <select id="getRecentWorkbooksByUserId" resultType="Workbook" parameterType="string">
        SELECT w.* FROM Workbook w
        INNER JOIN Subject s ON w.subjectId = s.subjectId
        WHERE s.groupId IN (
            SELECT groupId FROM GroupMember gm
            WHERE gm.userId = #{userId}
        )
        ORDER BY w.workbookDate DESC
        LIMIT 3; <!-- 최근 3개만 조회 -->
    </select>

    <!--문제집 수정-->
    <update id="updateWorkbook" parameterType="Workbook">
        UPDATE Workbook
        SET workbookTitle = #{workbookTitle}, workbookDetail = #{workbookDetail},
         workbookDeadline = #{workbookDeadline}, workbookQuota = #{workbookQuota}
        WHERE workbookId = #{workbookId}
    </update>

    <!--문제집 삭제-->
    <delete id="deleteWorkbook" parameterType="int">
        DELETE FROM Workbook
        WHERE workbookId = #{workbookId}
    </delete>
</mapper>